<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cinesquare.cinesquare.common.mapper.MovieMapper">
    <select id="searchMovie" parameterType="String" resultType="MovieVO">
        /* MovieMapper.searchMovie */
        SELECT movieCd
            , movieNm
            , openDt
            , janres
            , nations
            , showTm
            , content
            , mainImg
        FROM tb_movie
        WHERE REPLACE(movieNm, ' ', '') LIKE CONCAT('%', REPLACE(#{param}, ' ', ''), '%')
            OR REPLACE(content, ' ', '') LIKE CONCAT('%', REPLACE(#{param}, ' ', ''), '%')
            OR movieCd IN (
                        SELECT movieCd
                        FROM tb_character_roll
                        WHERE REPLACE(characterNm, ' ', '') LIKE CONCAT('%', REPLACE(#{param}, ' ', ''), '%')
                           OR REPLACE(realNm, ' ', '') LIKE CONCAT('%', REPLACE(#{param}, ' ', ''), '%'))
    </select>

    <select id="getBoxoffice" parameterType="String" resultType="Map">
        /* MovieMapper.getBoxoffice */
        SELECT reportDt
             , ranking
             , movieCd
             , movieNm
             , audience
             , mainImg
        FROM tb_daily_boxoffice
        ORDER BY reportDt DESC, ranking
        LIMIT 10
    </select>
</mapper>